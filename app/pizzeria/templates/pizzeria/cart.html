{% extends 'base.html' %}
{% load static %}
{% block title %}My Cart{% endblock %}

{% block content %}
{% if messages %}
  {% for message in messages %}
    <div class="alert alert-success">{{ message }}</div>
  {% endfor %}
{% endif %}
<h1>My Cart</h1>

{% if cart_items %}
  {% for item in cart_items %}
    <div>
      {% if item.image_filename %}
        <img src="{% static 'pizzeria/'|add:item.image_filename %}" alt="{{ item.name }}">
      {% endif %}

      <h3>{{ item.name }} ({{ item.size }})</h3>
      

      {% if item.extra_toppings %}
        <p>Base Price: {{ item.base_price }} kr</p>
        <p>Extra Toppings:</p>
        <ul>
          {% for topping in item.extra_toppings %}
            <li> {{ topping.name }} (+{{ topping.price }} kr)</li>
          {% endfor %}
        </ul>
      {% endif %}

      {% if item.removed_toppings %}
        <p>Removed Toppings:</p>
        <ul>
          {% for topping in item.removed_toppings %}
            <li>{{ topping.name }}</li>
          {% endfor %}
        </ul>
      {% endif %}

      <p>Total for this item: {{ item.total_price }} kr</p>

      <form method="post" action="{% url 'remove_item' %}">
        {% csrf_token %}
        <input type="hidden" name="item_index" value="{{ forloop.counter0 }}">
        <input type="submit" value="Remove" >
      </form>
    </div>
    <hr>
  {% endfor %}

  <p>Total: {{ total }} kr</p>

  <form method="post" action="{% url 'index' %}">
    {% csrf_token %}
    <input type="submit" value="Place Order">
  </form>

  <p><a href="{% url 'index' %}">Continue Shopping</a></p>
  <p><a href="{% url 'clear_cart' %}">Clear Cart</a></p>

{% else %}
  <p>Your cart is empty.</p>
  <p><a href="{% url 'index' %}">Browse Menu</a></p>
{% endif %}
{% endblock %}
